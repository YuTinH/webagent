<!doctype html>
<html lang="zh-CN">
<head>
<script>window.RelRoot = "../";</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æˆ‘çš„è´¦æˆ· - Nebulaç§»åŠ¨</title>
<link rel="stylesheet" href="../static/skin.css">
<link rel="stylesheet" href="../static/components.css">
<style>
.account-header {
  background: radial-gradient(100% 140% at 0% 0%, rgba(59, 130, 246, .12), transparent 40%), var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px;
  margin-bottom: 24px;
}
.account-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.plan-badge {
  background: var(--pri);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
}
.usage-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 24px;
}
.plan-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}
.plan-card {
  background: var(--card);
  border: 2px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  cursor: pointer;
  transition: .2s;
  position: relative;
}
.plan-card:hover {
  border-color: var(--pri);
  transform: translateY(-4px);
}
.plan-card.active {
  border-color: var(--ok);
  background: rgba(16, 185, 129, 0.05);
}
.plan-card.active::after {
  content: 'å½“å‰è®¡åˆ’';
  position: absolute;
  top: 12px;
  right: 12px;
  background: var(--ok);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 700;
}
.plan-name { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
.plan-price { font-size: 28px; font-weight: 700; color: var(--pri); margin-bottom: 16px; }
.plan-features li { margin-bottom: 8px; color: var(--muted); font-size: 14px; }
</style>
</head>
<body>

<!-- Navigation -->
<div class="navbar">
  <div class="inner">
    <div class="brand"><div class="logo"></div> Nebulaç§»åŠ¨</div>
    <div class="navlinks">
      <a href="../mobile.local/index.html">é¦–é¡µ</a>
      <a href="../mobile.local/account.html" class="active">æˆ‘çš„è´¦æˆ·</a>
      <a href="../mobile.local/support.html">å¸®åŠ©ä¸­å¿ƒ</a>
    </div>
  </div>
</div>

<div id="__toast" class="toast"></div>

<!-- Main Container -->
<div class="container">

  <h1 style="font-size:28px; font-weight:700; margin:24px 0">è´¦æˆ·æ¦‚è§ˆ</h1>

  <div class="account-header">
    <div class="account-info">
      <div>
        <h2 style="margin:0 0 8px 0">555-219-8937</h2>
        <div style="color:var(--muted)">ä¸‹ä¸€è´¦å•æ—¥: <span id="bill-date">2026-01-16</span></div>
      </div>
      <div class="plan-badge" id="current-plan-badge">Unlimited Plan</div>
    </div>
  </div>

  <div class="usage-card">
    <h3 style="margin:0 0 16px 0">æœ¬æœˆç”¨é‡</h3>
    <div style="display:flex; gap:40px">
      <div>
        <div style="font-size:14px; color:var(--muted)">æ•°æ®æµé‡</div>
        <div style="font-size:24px; font-weight:700">12.5 GB / <span id="data-limit">Unlimited</span></div>
      </div>
      <div>
        <div style="font-size:14px; color:var(--muted)">é€šè¯æ—¶é•¿</div>
        <div style="font-size:24px; font-weight:700">145 åˆ†é’Ÿ</div>
      </div>
    </div>
  </div>

  <h2 style="margin:32px 0 16px 0">æ›´æ¢å¥—é¤</h2>
  <div class="plan-options">
    <div class="plan-card" id="plan-starter">
      <div class="plan-name">å…¥é—¨å¥—é¤</div>
      <div class="plan-price">Â¥39/æœˆ</div>
      <ul class="plan-features">
        <li>5GB é«˜é€Ÿæµé‡</li>
        <li>200åˆ†é’Ÿé€šè¯</li>
        <li>æ— é™çŸ­ä¿¡</li>
      </ul>
      <button class="btn" onclick="selectPlan('starter')">é€‰æ‹©æ­¤å¥—é¤</button>
    </div>

    <div class="plan-card" id="plan-unlimited">
      <div class="plan-name">æ— é™ç•…äº«</div>
      <div class="plan-price">Â¥99/æœˆ</div>
      <ul class="plan-features">
        <li>æ— é™é«˜é€Ÿæµé‡</li>
        <li>æ— é™é€šè¯</li>
        <li>åŒ…å«å›½é™…æ¼«æ¸¸</li>
      </ul>
      <button class="btn" onclick="selectPlan('unlimited')">é€‰æ‹©æ­¤å¥—é¤</button>
    </div>

    <div class="plan-card" id="plan-pro">
      <div class="plan-name">ä¸“ä¸šç‰ˆ</div>
      <div class="plan-price">Â¥199/æœˆ</div>
      <ul class="plan-features">
        <li>æ— é™æµé‡ + 5Gæé€Ÿ</li>
        <li>å®¶åº­å…±äº«å‰¯å¡</li>
        <li>ä¸“å±å®¢æœé€šé“</li>
      </ul>
      <button class="btn" onclick="selectPlan('pro')">é€‰æ‹©æ­¤å¥—é¤</button>
    </div>
  </div>

  <div class="footer">Nebulaç§»åŠ¨ Â· Synthetic UI for Web Agent Research</div>
</div>

<!-- JavaScript -->
<script src="../static/common.js"></script>
<script src="../static/components.js"></script>
<script>
let currentPlanId = 'unlimited';

async function loadAccount() {
  try {
    const env = await loadEnv();
    const sub = env.mobile?.subscription;
    if (sub) {
      currentPlanId = sub.plan_id;
      document.getElementById('current-plan-badge').textContent = sub.plan_name;
      document.getElementById('data-limit').textContent = sub.data_limit;
      document.getElementById('bill-date').textContent = sub.next_bill_date;
      
      // Update UI
      document.querySelectorAll('.plan-card').forEach(card => {
        card.classList.remove('active');
        const btn = card.querySelector('button');
        btn.disabled = false;
        btn.textContent = 'é€‰æ‹©æ­¤å¥—é¤';
      });

      const activeCard = document.getElementById(`plan-${currentPlanId}`);
      if (activeCard) {
        activeCard.classList.add('active');
        const btn = activeCard.querySelector('button');
        btn.disabled = true;
        btn.textContent = 'å½“å‰å¥—é¤';
      }
    }
  } catch (e) {
    console.error("Failed to load account info:", e);
  }
}

async function selectPlan(planId) {
  if (planId === currentPlanId) return;

  Toast.info(`æ­£åœ¨åˆ‡æ¢è‡³ ${planId} å¥—é¤...`);

  try {
    const response = await send('A4-2025-MOBILE', 'mobile_subscribe', {
      planId: planId
    });

    if (response && (response.success || response.redirect)) {
      Toast.success('å¥—é¤åˆ‡æ¢æˆåŠŸï¼');
      // Fallback reload if redirect doesn't happen automatically
      setTimeout(loadAccount, 500);
    } else {
        console.warn('Response invalid, attempting fallback reload...');
        window.location.href = `${window.RelRoot}mobile.local/account.html?updated=true`;
    }
  } catch (error) {
    console.error('åˆ‡æ¢å¥—é¤å¤±è´¥:', error);
    if (error.message.includes('Network Error')) {
        console.warn('Network error detected, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}mobile.local/account.html?updated=true`;
    } else {
        Toast.error('åˆ‡æ¢å¥—é¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
    }
  }
}

document.addEventListener('DOMContentLoaded', loadAccount);
</script>

<!-- Distractor: Chat Widget -->
<div class="chat-widget" onclick="Toast.info('Chat support busy. Please try later.')">
  <span style="font-size:24px">ğŸ’¬</span>
</div>

</body>
</html>