<!doctype html>
<html lang="zh-CN">
<head>
<script>window.RelRoot = "../";</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å‘å¸ƒé—²ç½® - Nebulaç¤¾åŒº</title>
<link rel="stylesheet" href="../static/skin.css">
<link rel="stylesheet" href="../static/components.css">
<style>
.form-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px;
  max-width: 600px;
  margin: 0 auto;
}
.form-group {
  margin-bottom: 20px;
}
.form-group label {
  display: block;
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 8px;
}
.form-group input, .form-group select, .form-group textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: rgba(255,255,255,0.05);
  color: var(--text);
  font-size: 15px;
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
  outline: none;
  border-color: var(--pri);
  box-shadow: 0 0 0 2px rgba(79,70,229,0.2);
}
</style>
</head>
<body>

<!-- Navigation -->
<div class="navbar">
  <div class="inner">
    <div class="brand">
      <div class="logo"></div>
      Nebulaç¤¾åŒº
    </div>
    <div class="navlinks">
      <a href="../social.local/index.html">ç¤¾åŒºé¦–é¡µ</a>
      <a href="../market.local/index.html">äºŒæ‰‹å¸‚åœº</a>
      <a href="../market.local/my-listings.html">æˆ‘çš„å‘å¸ƒ</a>
    </div>
  </div>
</div>

<div id="__toast" class="toast"></div>

<!-- Main Container -->
<div class="container">

  <h1 style="text-align:center; font-size:28px; font-weight:700; margin:32px 0">å‘å¸ƒæ‚¨çš„é—²ç½®ç‰©å“</h1>

  <div class="form-card">
    <div class="form-group">
      <label for="item-name">ç‰©å“åç§°</label>
      <input type="text" id="item-name" placeholder="ä¾‹å¦‚ï¼šé—²ç½®è‡ªè¡Œè½¦">
    </div>
    <div class="form-group">
      <label for="description">è¯¦ç»†æè¿°</label>
      <textarea id="description" rows="4" placeholder="æè¿°ç‰©å“çš„çŠ¶å†µã€ç‰¹ç‚¹ç­‰..."></textarea>
    </div>
    <div class="form-group">
      <label for="price">ä»·æ ¼ (Â¥)</label>
      <input type="number" id="price" placeholder="ä¾‹å¦‚ï¼š200">
    </div>
    <div class="form-group">
      <label for="category">åˆ†ç±»</label>
      <select id="category">
        <option value="electronics">ç”µå­äº§å“</option>
        <option value="furniture">å®¶å…·</option>
        <option value="books">ä¹¦ç±</option>
        <option value="sports">è¿åŠ¨æˆ·å¤–</option>
        <option value="other">å…¶ä»–</option>
      </select>
    </div>
    <div class="form-group">
      <label for="photo-upload">ä¸Šä¼ ç…§ç‰‡ (å¯é€‰)</label>
      <input type="file" id="photo-upload">
    </div>
    <button class="btn pri lg" style="width:100%" onclick="submitListing()">ç¡®è®¤å‘å¸ƒ</button>
  </div>

  <div class="footer">Nebulaç¤¾åŒº Â· Synthetic UI for Web Agent Research</div>
</div>

<!-- JavaScript -->
<script src="../static/common.js"></script>
<script src="../static/components.js"></script>
<script>
async function submitListing() {
  const itemName = document.getElementById('item-name').value;
  const description = document.getElementById('description').value;
  const price = document.getElementById('price').value;
  const category = document.getElementById('category').value;
  const photoInput = document.getElementById('photo-upload');
  const photoName = photoInput.files.length > 0 ? photoInput.files[0].name : '';

  if (!itemName || !price || !category) {
    Toast.error('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹');
    return;
  }

  Toast.info('æ­£åœ¨å‘å¸ƒç‰©å“...');

  try {
    const response = await send('B7-2025-MARKET', 'list_second_hand_item', {
      name: itemName,
      description: description,
      price: parseFloat(price),
      category: category,
      photo_name: photoName
    });

    if (response && (response.success || response.redirect)) {
      Toast.success('ç‰©å“å‘å¸ƒæˆåŠŸï¼');
      // Fallback reload if redirect doesn't happen automatically
      if (!response.redirect) {
          window.location.href = `${window.RelRoot}market.local/index.html?listed=true`;
      }
    } else {
        console.warn('Response invalid, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}market.local/index.html?listed=true`;
    }
  } catch (error) {
    console.error('å‘å¸ƒå¤±è´¥:', error);
    if (error.message.includes('Network Error')) {
        console.warn('Network error detected, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}market.local/index.html?listed=true`;
    } else {
        Toast.error('å‘å¸ƒå¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);
    if (params.get('listed') === 'true') {
        Toast.success('ç‰©å“å‘å¸ƒæˆåŠŸï¼');
    }
});
</script>

<!-- Distractor: Chat Widget -->
<div class="chat-widget" onclick="Toast.info('Chat support busy. Please try later.')">
  <span style="font-size:24px">ğŸ’¬</span>
</div>

</body>
</html>