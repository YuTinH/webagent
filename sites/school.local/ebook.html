<!doctype html>
<html lang="zh-CN">
<head>
<script>window.RelRoot = "../";</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="page-title">ç”µå­ä¹¦è¯¦æƒ… - Nebulaå­¦æ ¡</title>
<link rel="stylesheet" href="../static/skin.css">
<link rel="stylesheet" href="../static/components.css">
<style>
.book-details-grid {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 40px;
}
.book-cover-large {
  width: 100%;
  height: 400px;
  background-color: #334155;
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 96px;
  box-shadow: var(--shadow);
}
.book-info-large h1 {
  font-size: 32px;
  margin: 0 0 8px 0;
}
.book-author-large {
  font-size: 18px;
  color: var(--muted);
  margin-bottom: 24px;
}
.book-price-large {
  font-size: 36px;
  font-weight: 700;
  color: var(--pri);
  margin-bottom: 32px;
}
.book-description {
  line-height: 1.8;
  margin-bottom: 32px;
}
</style>
</head>
<body>

<!-- Navigation -->
<div class="navbar">
  <div class="inner">
    <div class="brand"><div class="logo"></div> Nebulaå­¦æ ¡</div>
    <div class="navlinks">
      <a href="../school.local/index.html">é¦–é¡µ</a>
      <a href="../school.local/catalog.html" class="active">è¯¾ç¨‹ç›®å½•</a>
      <a href="../school.local/my-learning.html">æˆ‘çš„å­¦ä¹ </a>
    </div>
  </div>
</div>

<div id="__toast" class="toast"></div>

<!-- Main Container -->
<div class="container">

  <div class="book-details-grid" id="book-content">
    <div class="book-cover-large">ğŸ“˜</div>
    <div class="book-info-large">
      <h1 id="book-title">åŠ è½½ä¸­...</h1>
      <div class="book-author-large" id="book-author"></div>
      <div class="book-price-large">Â¥<span id="book-price"></span></div>
      <div class="book-description" id="book-description"></div>
      <button class="btn pri lg" onclick="buyEbook()">è´­ä¹°ç”µå­ä¹¦</button>
    </div>
  </div>

  <div class="footer">Nebulaå­¦æ ¡ Â· Synthetic UI for Web Agent Research</div>
</div>

<!-- JavaScript -->
<script src="../static/common.js"></script>
<script src="../static/components.js"></script>
<script>
let bookId = '';
let bookPrice = 0;

async function loadBookDetails() {
  const urlParams = new URLSearchParams(window.location.search);
  bookId = urlParams.get('id') || 'BK-101';

  const bookData = {
    'BK-101': { title: 'Web AgentåŸç†', author: 'Masteryth', price: 49.99, description: 'æœ¬ä¹¦è¯¦ç»†ä»‹ç»äº†Web Agentçš„æ ¸å¿ƒæ¶æ„ã€æ„ŸçŸ¥æ¨¡å—ã€å†³ç­–å¼•æ“ä»¥åŠæ‰§è¡Œæ§åˆ¶å™¨çš„è®¾è®¡ä¸å®ç°ã€‚' },
    'BK-102': { title: 'Pythonæ•°æ®åˆ†æ', author: 'Alice', price: 59.99, description: 'ä»é›¶å¼€å§‹å­¦ä¹ Pythonæ•°æ®åˆ†æï¼Œæ¶µç›–Pandasã€NumPyã€Matplotlibç­‰ä¸»æµåº“çš„ä½¿ç”¨ã€‚' },
    'BK-103': { title: 'æ·±åº¦å­¦ä¹ å¯¼è®º', author: 'Bob', price: 69.99, description: 'æ·±åº¦å­¦ä¹ å…¥é—¨ç»å…¸ï¼Œé€šè¿‡ä¸°å¯Œçš„æ¡ˆä¾‹å’Œä»£ç ç¤ºä¾‹ï¼Œå¸¦ä½ é¢†ç•¥æ·±åº¦å­¦ä¹ çš„é­…åŠ›ã€‚' }
  };

  const book = bookData[bookId];
  if (book) {
    document.getElementById('page-title').textContent = `${book.title} - Nebulaå­¦æ ¡`;
    document.getElementById('book-title').textContent = book.title;
    document.getElementById('book-author').textContent = `ä½œè€…: ${book.author}`;
    document.getElementById('book-price').textContent = book.price;
    document.getElementById('book-description').textContent = book.description;
    bookPrice = book.price;
  } else {
    document.getElementById('book-content').innerHTML = '<h1>æœªæ‰¾åˆ°ä¹¦ç±</h1>';
  }
}

async function buyEbook() {
  Toast.info('æ­£åœ¨å¤„ç†è´­ä¹°...');

  try {
    const response = await send('J2-2025-EBOOK', 'buy_ebook', {
      bookId: bookId,
      title: document.getElementById('book-title').textContent,
      price: bookPrice
    });

    if (response && (response.success || response.redirect)) {
      Toast.success('è´­ä¹°æˆåŠŸï¼');
      window.location.href = `${window.RelRoot}school.local/my-learning.html?new_book=true`;
    } else {
        console.warn('Response invalid, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}school.local/my-learning.html?new_book=true`;
    }
  } catch (error) {
    console.error('è´­ä¹°å¤±è´¥:', error);
    if (error.message.includes('Network Error')) {
        console.warn('Network error detected, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}school.local/my-learning.html?new_book=true`;
    } else {
        Toast.error('è´­ä¹°å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
    }
  }
}

document.addEventListener('DOMContentLoaded', loadBookDetails);
</script>

<!-- Distractor: Chat Widget -->
<div class="chat-widget" onclick="Toast.info('Chat support busy. Please try later.')">
  <span style="font-size:24px">ğŸ’¬</span>
</div>

</body>
</html>
