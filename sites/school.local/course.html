<!doctype html>
<html lang="zh-CN">
<head>
<script>window.RelRoot = "../";</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="page-title">è¯¾ç¨‹è¯¦æƒ… - Nebulaå­¦æ ¡</title>
<link rel="stylesheet" href="../static/skin.css">
<link rel="stylesheet" href="../static/components.css">
<style>
.course-header {
  background: radial-gradient(100% 140% at 0% 0%, rgba(139, 92, 246, .12), transparent 40%), var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px;
  margin-bottom: 24px;
  text-align: center;
}
.course-header h1 {
  font-size: 32px;
  margin: 0 0 12px 0;
}
.course-meta {
  color: var(--muted);
  font-size: 16px;
  margin-bottom: 24px;
}
.course-sections {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 24px;
}
.course-section-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 20px;
}
.section-title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 16px;
}
.syllabus-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 0;
  border-bottom: 1px dashed var(--border);
}
.syllabus-item:last-child {
  border-bottom: none;
}
.syllabus-icon {
  font-size: 24px;
}
.syllabus-info {
  flex: 1;
}
.syllabus-title {
  font-weight: 500;
}
.syllabus-duration {
  color: var(--muted);
  font-size: 14px;
}
</style>
</head>
<body>

<!-- Navigation -->
<div class="navbar">
  <div class="inner">
    <div class="brand"><div class="logo"></div> Nebulaå­¦æ ¡</div>
    <div class="navlinks">
      <a href="../school.local/index.html">é¦–é¡µ</a>
      <a href="../school.local/catalog.html">è¯¾ç¨‹ç›®å½•</a>
      <a href="../school.local/my-learning.html">æˆ‘çš„å­¦ä¹ </a>
    </div>
    <div style="margin-left:auto">
      <button id="user-menu-btn" style="background:none; border:none; color:var(--text); font-size:20px; cursor:pointer">
        ğŸ‘¤
      </button>
    </div>
  </div>
</div>

<div id="__toast" class="toast"></div>

<!-- Main Container -->
<div class="container">

  <div id="course-details">
    <div class="course-header">
      <h1 id="course-title">åŠ è½½ä¸­...</h1>
      <div class="course-meta">è®²å¸ˆ: <span id="course-instructor"></span> Â· å­¦åˆ†: <span id="course-credits"></span></div>
      <button class="btn pri lg" id="enroll-button" onclick="enrollCourse()">ç«‹å³æŠ¥å</button>
    </div>

    <div class="course-sections">
      <div>
        <div class="course-section-card">
          <div class="section-title">è¯¾ç¨‹ç®€ä»‹</div>
          <p id="course-description">åŠ è½½ä¸­...</p>
        </div>
        <div class="course-section-card">
          <div class="section-title">è¯¾ç¨‹å¤§çº²</div>
          <div id="course-syllabus">
            <!-- Syllabus items injected here -->
          </div>
        </div>
      </div>
      <div>
        <div class="course-section-card">
          <div class="section-title">è¯¾ç¨‹è¯„ä»·</div>
          <div style="text-align:center; color:var(--muted); font-size:14px">æš‚æ— è¯„ä»·</div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">Nebulaå­¦æ ¡ Â· Synthetic UI for Web Agent Research</div>
</div>

<!-- JavaScript -->
<script src="../static/common.js"></script>
<script src="../static/components.js"></script>
<script>
let courseId = '';

async function loadCourseDetails() {
  const urlParams = new URLSearchParams(window.location.search);
  courseId = urlParams.get('id') || 'DL101'; // Default course ID
  
  const courseData = { // Mock data for now
    'DL101': {
      title: 'Web Agentç¼–ç¨‹æŒ‡å—',
      instructor: 'Masteryth',
      credits: 3,
      description: 'æ·±å…¥äº†è§£Web Agentçš„å¼€å‘åŸç†ä¸å®æˆ˜æŠ€å·§ï¼ŒæŒæ¡è‡ªåŠ¨åŒ–æ“ä½œä¸æ•°æ®æå–æŠ€æœ¯ã€‚',
      syllabus: [
        { title: 'Web Agentæ¦‚è¿°', duration: '1å°æ—¶' },
        { title: 'PlaywrightåŸºç¡€', duration: '2å°æ—¶' }
      ]
    },
    'ML202': {
      title: 'æœºå™¨å­¦ä¹ è¿›é˜¶',
      instructor: 'Alice',
      credits: 4,
      description: 'æ¢ç´¢é«˜çº§æœºå™¨å­¦ä¹ ç®—æ³•ï¼ŒåŒ…æ‹¬æ·±åº¦å­¦ä¹ ã€å¼ºåŒ–å­¦ä¹ åŠå…¶åº”ç”¨ã€‚',
      syllabus: [
        { title: 'ç¥ç»ç½‘ç»œåŸºç¡€', duration: '2å°æ—¶' },
        { title: 'CNNä¸RNN', duration: '3å°æ—¶' },
        { title: 'Transformeræ¨¡å‹', duration: '3å°æ—¶' },
        { title: 'å¼ºåŒ–å­¦ä¹ å¯¼è®º', duration: '2å°æ—¶' }
      ]
    }
  };

  const course = courseData[courseId];
  if (course) {
    document.getElementById('page-title').textContent = `${course.title} - Nebulaå­¦æ ¡`;
    document.getElementById('course-title').textContent = course.title;
    document.getElementById('course-instructor').textContent = course.instructor;
    document.getElementById('course-credits').textContent = course.credits;
    document.getElementById('course-description').textContent = course.description;

    const syllabusContainer = document.getElementById('course-syllabus');
    syllabusContainer.innerHTML = course.syllabus.map(item => `
      <div class="syllabus-item">
        <div class="syllabus-icon">ğŸ“–</div>
        <div class="syllabus-info">
          <div class="syllabus-title">${item.title}</div>
          <div class="syllabus-duration">${item.duration}</div>
        </div>
      </div>
    `).join('');

    // Check if already enrolled
    const env = await loadEnv();
    const enrolled = env.courses?.[courseId]?.state === 'enrolled';
    if (enrolled) {
      const btn = document.getElementById('enroll-button');
      btn.textContent = 'å·²æŠ¥å';
      btn.disabled = true;
      btn.classList.remove('pri');
      btn.classList.add('ok');
    }
  } else {
    document.getElementById('course-details').innerHTML = '<div class="course-header"><h1>è¯¾ç¨‹æœªæ‰¾åˆ°</h1></div>';
  }
}

async function enrollCourse() {
  const btn = document.getElementById('enroll-button');
  btn.disabled = true;
  btn.textContent = 'æ­£åœ¨æŠ¥å...';

  try {
    const response = await send('J1-2025-ENROLL', 'enroll_course', {
      courseId: courseId
    });

    if (response && (response.success || response.redirect)) {
      Toast.success('æŠ¥åæˆåŠŸï¼');
      window.location.href = `${window.RelRoot}school.local/my-learning.html?enrolled=true`;
    } else {
        console.warn('Response invalid, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}school.local/my-learning.html?enrolled=true`;
    }
  } catch (error) {
    console.error('æŠ¥åå¤±è´¥:', error);
    if (error.message.includes('Network Error')) {
        console.warn('Network error detected, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}school.local/my-learning.html?enrolled=true`;
    } else {
        Toast.error('æŠ¥åå¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
        btn.disabled = false;
        btn.textContent = 'ç«‹å³æŠ¥å';
    }
  }
}

document.addEventListener('DOMContentLoaded', loadCourseDetails);
</script>

<!-- Distractor: Chat Widget -->
<div class="chat-widget" onclick="Toast.info('Chat support busy. Please try later.')">
  <span style="font-size:24px">ğŸ’¬</span>
</div>

</body>
</html>