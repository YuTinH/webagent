<!doctype html>
<html lang="zh-CN">
<head>
<script>window.RelRoot = "../";</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="page-title">æˆ¿æºè¯¦æƒ… - æ™ºæ…§å±…ä½</title>
<link rel="stylesheet" href="../static/skin.css">
<link rel="stylesheet" href="../static/components.css">
<style>
.property-details-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 24px;
}
.main-image {
  width: 100%;
  height: 400px;
  background-color: #334155;
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 120px;
  margin-bottom: 24px;
}
.detail-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 20px;
}
.detail-section-title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 16px;
}
.feature-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.feature-list li {
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  padding: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
}
.key-value-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.key-value-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 15px;
}
.key-value-item .key {
  color: var(--muted);
}
.apply-section {
  position: sticky;
  top: 80px;
}
.apply-button {
  width: 100%;
  padding: 18px;
  font-size: 17px;
  font-weight: 700;
}
</style>
</head>
<body>

<!-- Navigation -->
<div class="navbar">
  <div class="inner">
    <div class="brand">
      <div class="logo"></div>
      æ™ºæ…§å±…ä½
    </div>
    <div class="navlinks">
      <a href="../housing.local/index.html" class="active">æ‰¾æˆ¿</a>
      <a href="../housing.local/applications.html">æˆ‘çš„ç”³è¯·</a>
      <a href="../housing.local/leasing.html">æˆ‘çš„ç§Ÿèµ</a>
    </div>
  </div>
</div>

<div id="__toast" class="toast"></div>

<!-- Main Container -->
<div class="container">

  <div id="property-details-content">
    <div class="property-details-grid">
      <div>
        <div class="main-image">ğŸ </div>
        <div class="detail-card">
          <div class="detail-section-title" id="property-address">åŠ è½½ä¸­...</div>
          <p id="property-description">åŠ è½½ä¸­...</p>
        </div>

        <div class="detail-card">
          <div class="detail-section-title">æˆ¿æºç‰¹è‰²</div>
          <ul class="feature-list">
            <li>âœ¨ å…¨æ–°è£…ä¿®</li>
            <li>ğŸ…¿ï¸ å…è´¹åœè½¦ä½</li>
            <li>ğŸš‡ äº¤é€šä¾¿åˆ©</li>
            <li>ğŸŒ³ å°åŒºç»¿åŒ–</li>
          </ul>
        </div>
      </div>

      <div>
        <div class="detail-card apply-section">
          <div class="detail-section-title">ç”³è¯·ä¿¡æ¯</div>
          <div class="key-value-list">
            <div class="key-value-item">
              <span class="key">ç§Ÿé‡‘</span>
              <span class="value">Â¥<span id="property-price">0</span>/æœˆ</span>
            </div>
            <div class="key-value-item">
              <span class="key">æˆ¿å‹</span>
              <span class="value" id="property-type"></span>
            </div>
            <div class="key-value-item">
              <span class="key">é¢ç§¯</span>
              <span class="value" id="property-area"></span>
            </div>
            <div class="key-value-item">
              <span class="key">å§å®¤</span>
              <span class="value" id="property-beds"></span>
            </div>
            <div class="key-value-item">
              <span class="key">å«ç”Ÿé—´</span>
              <span class="value" id="property-baths"></span>
            </div>
            <div class="key-value-item">
              <span class="key">æœ€çŸ­ç§ŸæœŸ</span>
              <select id="lease-term" style="width:auto; padding:8px">
                <option value="6 months">6ä¸ªæœˆ</option>
                <option value="12 months">12ä¸ªæœˆ</option>
                <option value="24 months">24ä¸ªæœˆ</option>
              </select>
            </div>
          </div>
          <button class="btn pri apply-button" onclick="applyToRent()">ç”³è¯·ç§Ÿèµ</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    æ™ºæ…§å±…ä½ Â· Synthetic UI for Web Agent Research
  </div>

</div>

<!-- JavaScript -->
<script src="../static/common.js"></script>
<script src="../static/components.js"></script>
<script>
let propertyId = '';

async function loadPropertyDetails() {
  const urlParams = new URLSearchParams(window.location.search);
  propertyId = urlParams.get('id') || 'PROP-101'; // Default property ID

  const propertyData = { // Mock data
    'PROP-101': {
      address: 'ä¸­å¤®å¤§è¡—101å·',
      location: 'Springfield',
      type: 'å…¬å¯“',
      price: 3500,
      area: '80å¹³ç±³',
      beds: 2,
      baths: 1,
      description: 'å¸‚ä¸­å¿ƒè±ªåå…¬å¯“ï¼Œäº¤é€šä¾¿åˆ©ï¼Œè®¾æ–½é½å…¨ï¼Œé‡‡å…‰æä½³ã€‚'
    },
    'PROP-102': {
      address: 'é˜³å…‰æµ·å²¸åˆ«å¢…åŒº20å·',
      location: 'Springfield',
      type: 'ç‹¬æ ‹åˆ«å¢…',
      price: 8000,
      area: '200å¹³ç±³',
      beds: 4,
      baths: 3,
      description: 'æµ·æ™¯åˆ«å¢…ï¼Œå®½æ•æ˜äº®ï¼Œå¸¦ç‹¬ç«‹èŠ±å›­å’Œæ³³æ± ï¼Œå°Šäº«å¥¢åç”Ÿæ´»ã€‚'
    }
  };

  const property = propertyData[propertyId];
  if (property) {
    document.getElementById('page-title').textContent = `${property.address} - æ™ºæ…§å±…ä½`;
    document.getElementById('property-address').textContent = property.address;
    document.getElementById('property-description').textContent = property.description;
    document.getElementById('property-price').textContent = property.price;
    document.getElementById('property-type').textContent = property.type;
    document.getElementById('property-area').textContent = property.area;
    document.getElementById('property-beds').textContent = property.beds;
    document.getElementById('property-baths').textContent = property.baths;
  } else {
    document.getElementById('property-details-content').innerHTML = '<div class="main-image">â“</div><div class="detail-card"><h1>æˆ¿æºæœªæ‰¾åˆ°</h1></div>';
  }
}

async function applyToRent() {
  const leaseTerm = document.getElementById('lease-term').value;

  Toast.info('æ­£åœ¨æäº¤ç§Ÿèµç”³è¯·...');

  try {
    const response = await send('A1-2025-HOME', 'rent_property', {
      propertyId: propertyId,
      leaseTerm: leaseTerm
    });

    if (response && (response.success || response.redirect)) {
      Toast.success('ç§Ÿèµç”³è¯·æˆåŠŸï¼');
      window.location.href = `${window.RelRoot}housing.local/leasing.html?applied=true`;
    } else {
        console.warn('Response invalid, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}housing.local/leasing.html?applied=true`;
    }
  } catch (error) {
    console.error('ç”³è¯·ç§Ÿèµå¤±è´¥:', error);
    if (error.message.includes('Network Error')) {
        console.warn('Network error detected, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}housing.local/leasing.html?applied=true`;
    } else {
        Toast.error('ç”³è¯·ç§Ÿèµå¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
    }
  }
}

document.addEventListener('DOMContentLoaded', loadPropertyDetails);
</script>

<!-- Distractor: Chat Widget -->
<div class="chat-widget" onclick="Toast.info('Chat support busy. Please try later.')">
  <span style="font-size:24px">ğŸ’¬</span>
</div>

</body>
</html>