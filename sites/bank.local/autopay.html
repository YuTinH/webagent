<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank.local - Set up Autopay</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; color: #333; }
        .container { background-color: #ffffff; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center; max-width: 600px; width: 90%; margin-top: 50px; }
        h1 { color: #2c3e50; margin-bottom: 25px; font-size: 2.2em; }
        .form-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .btn-submit { background-color: #28a745; color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; transition: background-color 0.3s ease; text-decoration: none; display: inline-block; margin-top: 20px; }
        .btn-submit:hover { background-color: #218838; }
        .message { margin-top: 20px; font-weight: bold; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .confirmation-card { background-color: #e8f5e9; border: 1px solid #28a745; color: #28a745; padding: 20px; border-radius: 8px; margin-top: 30px; }
        .confirmation-card h2 { color: #28a745; margin-top: 0; }
        .confirmation-card .status-badge { background-color: #28a745; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold; }
    </style>
    <script src="/static/common.js"></script>
</head>
<body>
    <div class="container">
        <h1 id="page-title">Set Up Autopay</h1>
        
        <form id="autopay-form">
            <div class="form-group">
                <label for="payee">Payee</label>
                <input type="text" id="payee" value="Utilities" required>
            </div>
            <div class="form-group">
                <label for="amount">Amount</label>
                <input type="number" id="amount" value="150" required>
            </div>
            <div class="form-group">
                <label for="frequency">Frequency</label>
                <select id="frequency" required>
                    <option value="monthly">Monthly</option>
                    <option value="weekly">Weekly</option>
                    <option value="quarterly">Quarterly</option>
                </select>
            </div>
            <div class="form-group">
                <label for="accountType">Account Type</label>
                <select id="accountType" required>
                    <option value="checking">Checking</option>
                    <option value="savings">Savings</option>
                </select>
            </div>
            <div class="form-group">
                <label for="startDate">Start Date</label>
                <input type="date" id="startDate" value="2025-12-20" required>
            </div>

            <button type="button" class="btn-submit" onclick="setupAutopay()">Confirm Autopay</button>
        </form>

        <div id="confirmation-section" class="confirmation-card" style="display:none;">
            <h2>Autopay Setup Successful!</h2>
            <p>Your autopay for <span id="conf-payee"></span> has been activated.</p>
            <p>Status: <span id="autopay-status" class="status-badge">active</span></p>
            <p>Amount: $<span id="conf-amount"></span></p>
            <p>Frequency: <span id="conf-frequency"></span></p>
            <p>Next Payment: <span id="conf-next-date"></span></p>
        </div>

        <p class="message" id="status-message"></p>
    </div>

    <script>
        window.RelRoot = '../'; // Assuming autopay.html is directly under bank.local

        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        document.getElementById('startDate').value = `${yyyy}-${mm}-${dd}`;

        const urlParams = new URLSearchParams(window.location.search);
        const state = urlParams.get('state');
        const payee = urlParams.get('payee');
        const amount = urlParams.get('amount');
        const frequency = urlParams.get('frequency');
        const nextDate = urlParams.get('next_date');

        if (state === 'active') {
            document.getElementById('page-title').textContent = 'Autopay Status';
            document.getElementById('autopay-form').style.display = 'none';
            document.getElementById('confirmation-section').style.display = 'block';

            document.getElementById('conf-payee').textContent = payee || 'Utilities';
            document.getElementById('conf-amount').textContent = amount || '150';
            document.getElementById('conf-frequency').textContent = frequency || 'Monthly';
            document.getElementById('conf-next-date').textContent = nextDate || '2025-12-20';
            document.getElementById('autopay-status').textContent = 'active';
        }

        function setupAutopay() {
            const payee = document.getElementById('payee').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const frequency = document.getElementById('frequency').value;
            const accountType = document.getElementById('accountType').value;
            const startDate = document.getElementById('startDate').value;

            send('D3-2025-AUTOPAY', 'setup_autopay', {
                payee: payee,
                amount: amount,
                frequency: frequency,
                account_type: accountType,
                start_date: startDate
            });
        }
    </script>
</body>
</html>