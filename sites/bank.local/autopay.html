<!doctype html>
<html lang="zh-CN">
<head>
<script>window.RelRoot = "../";</script>
  <meta charset="utf-8">
  <title>bank.local - è‡ªåŠ¨æ‰£æ¬¾</title>
  <link rel="stylesheet" href="../static/skin.css">
<link rel="stylesheet" href="../static/components.css">
</head>
<body class="page">
  <div class="navbar">
    <div class="inner">
      <div class="brand"><div class="logo"></div> Nebula Bank</div>
      <div class="navlinks">
        <a href="../bank.local/dashboard">æ€»è§ˆ</a>
        <a href="../bank.local/transactions">äº¤æ˜“</a>
        <a href="../bank.local/autopay" class="active">è‡ªåŠ¨æ‰£æ¬¾</a>
      </div>
    </div>
  </div>
  <div id="__toast" class="toast"></div>
  <div class="container">

<!-- Distractor: Top Ad Banner -->
<div class="ad-banner" style="margin: 0 0 24px 0; background: linear-gradient(90deg, #ec4899, #8b5cf6);">
  <div style="display:flex; align-items:center; gap:16px">
    <span style="font-size:24px">ğŸ</span>
    <div>
      <div style="font-weight:700">Flash Sale</div>
      <div style="font-size:13px; opacity:0.9">Ends in 02:14:59</div>
    </div>
  </div>
  <button class="btn" style="background:rgba(255,255,255,0.2); border:none; color:white; font-size:13px">Shop</button>
</div>

    <div class="breadcrumbs"><a href="../bank.local/dashboard">é“¶è¡Œ</a> / <span>è‡ªåŠ¨æ‰£æ¬¾</span></div>
    <div class="grid cols-2">
      <div class="card">
        <div class="header"><div class="title">æ–°å¢è‡ªåŠ¨æ‰£æ¬¾</div></div>
        <div class="form">
          <label>ç¼´è´¹å¯¹è±¡</label>
          <select id="payee" class="input">
            <option value="utilities">City Utilities</option>
            <option value="landlord">Landlord</option>
            <option value="internet">Internet Provider</option>
          </select>
          <label>æ‰£æ¬¾è´¦æˆ·</label>
          <select id="account" class="input">
            <option value="checking">Checking ****1234</option>
            <option value="savings">Savings ****0001</option>
          </select>
          <label>é‡‘é¢ (USD)</label>
          <input id="amount" type="number" class="input" placeholder="130.50" value="130.50">
          <label>é¢‘ç‡</label>
          <select id="frequency" class="input">
            <option value="monthly" selected>æ¯æœˆ</option>
            <option value="weekly">æ¯å‘¨</option>
            <option value="quarterly">æ¯å­£åº¦</option>
          </select>
          <label>å¼€å§‹æ—¥æœŸ</label>
          <input id="start-date" type="date" class="input" value="2025-11-28">
          <button class="btn pri add-autopay save-autopay" onclick="createAutopay()">ä¿å­˜è®¾ç½®</button>
        </div>
      </div>
      <div class="card" id="autopay-card">
        <div class="header"><div class="title">å½“å‰è‡ªåŠ¨æ‰£æ¬¾</div></div>
        <div id="autopay-list" class="kv" style="gap:12px"></div>
        <div class="autopay-status badge" style="margin-top:12px">æœªè®¾ç½®</div>
      </div>
    </div>
  </div>
<script src="../static/common.js"></script>
<script src="../static/components.js"></script>
  <script>
  async function fetchAutopay(){
    const res = await fetch('../api/autopay');
    const data = await res.json();
    const list = document.getElementById('autopay-list');
    if (data.items.length === 0){
      list.innerHTML = '<div class="muted">æš‚æ— è‡ªåŠ¨æ‰£æ¬¾</div>';
      return;
    }
    list.innerHTML = data.items.map(item => `
      <div>
        <div><strong>${item.payee}</strong> (${item.state})</div>
        <div>è´¦æˆ·ï¼š${item.account_type} Â· é¢‘ç‡ï¼š${item.frequency}</div>
        <div>ä¸‹æ¬¡æ—¥æœŸï¼š${item.next_date}</div>
      </div>
    `).join('');
    document.querySelector('.autopay-status').textContent = data.items[0].state;
  }
  async function createAutopay(){
    const body = {
      payee: document.getElementById('payee').value,
      account_type: document.getElementById('account').value,
      amount: parseFloat(document.getElementById('amount').value || '0'),
      frequency: document.getElementById('frequency').value,
      start_date: document.getElementById('start-date').value
    };
    const res = await fetch('../api/autopay', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    const data = await res.json();
    if (data.success){
      document.querySelector('.autopay-status').textContent = data.autopay.state;
      document.querySelector('.autopay-status').classList.add('badge','ok');
      toast('è‡ªåŠ¨æ‰£æ¬¾å·²å¯ç”¨');
      fetchAutopay();
    } else {
      toast('æäº¤å¤±è´¥');
    }
  }
  document.addEventListener('DOMContentLoaded', fetchAutopay);
  </script>

<!-- Distractor: Random Toast -->
<script>
setTimeout(() => {
  const msgs = ['New order from Tokyo', 'Server maintenance in 10m', 'High demand area', 'Stock running low'];
  const msg = msgs[Math.floor(Math.random() * msgs.length)];
  if (typeof Toast !== 'undefined') Toast.info(msg);
}, 3500);
</script>

</body>
</html>
