<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utility Setup - Energy.local</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; color: #333; }
        .container { background-color: #ffffff; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center; max-width: 600px; width: 90%; margin-top: 50px; }
        h1 { color: #2c3e50; margin-bottom: 25px; font-size: 2.2em; }
        .form-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type="checkbox"] { margin-right: 10px; }
        select, input[type="text"], input[type="date"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .btn-submit { background-color: #28a745; color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; transition: background-color 0.3s ease; text-decoration: none; display: inline-block; margin-top: 20px; }
        .btn-submit:hover { background-color: #218838; }
        .message { margin-top: 20px; font-weight: bold; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
    <script src="/static/common.js"></script>
</head>
<body>
    <div class="container">
        <h1>Setup New Utility Services</h1>
        
        <form id="utility-setup-form">
            <div class="form-group">
                <label for="address">Service Address</label>
                <input type="text" id="address" value="123 Main St, Springfield" required>
            </div>

            <div class="form-group">
                <label>Select Services</label>
                <div>
                    <input type="checkbox" id="service-electricity" value="electricity" checked>
                    <label for="service-electricity">Electricity (Plan: Standard)</label>
                </div>
                <div>
                    <input type="checkbox" id="service-water" value="water" checked>
                    <label for="service-water">Water (Plan: Standard)</label>
                </div>
                <div>
                    <input type="checkbox" id="service-broadband" value="broadband" checked>
                    <label for="service-broadband">Broadband (Plan: Postpaid Auto)</label>
                </div>
            </div>

            <div class="form-group">
                <label for="start-date">Connection Date</label>
                <input type="date" id="start-date" value="2025-12-17" required>
            </div>

            <button type="button" class="btn-submit" onclick="setupUtilities()">Confirm Setup</button>
        </form>

        <p class="message" id="status-message"></p>
    </div>

    <script>
        // Set today's date as default
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months start at 0!
        const dd = String(today.getDate()).padStart(2, '0');
        document.getElementById('start-date').value = `${yyyy}-${mm}-${dd}`;

        async function setupUtilities() {
            const address = document.getElementById('address').value;
            const services = [];
            const plans = {};

            if (document.getElementById('service-electricity').checked) {
                services.push('electricity');
                plans['electricity'] = 'standard';
            }
            if (document.getElementById('service-water').checked) {
                services.push('water');
                plans['water'] = 'standard';
            }
            if (document.getElementById('service-broadband').checked) {
                services.push('broadband');
                plans['broadband'] = 'postpaid-auto';
            }

            const startDate = document.getElementById('start-date').value;

            send('A3-2025-UTIL', 'setup_utility', {
                address: address,
                services: services,
                plans: plans,
                date: startDate
            });
            // The send function handles redirection, so no further client-side action needed here.
        }
    </script>
</body>
</html>