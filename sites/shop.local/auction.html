<!doctype html>
<html lang="zh-CN">
<head>
<script>window.RelRoot = "../";</script>
  <meta charset="utf-8">
  <title>Live Auction - Nebula Shop</title>
  <link rel="stylesheet" href="../static/skin.css">
  <link rel="stylesheet" href="../static/components.css">
  <script src="../static/common.js"></script>
  <script src="../static/components.js"></script>
</head>
<body class="page">
  <div class="navbar">
    <div class="inner">
      <div class="brand">ğŸ›ï¸ Shop.local</div>
      <div class="navlinks">
        <a href="../shop.local/index.html">é¦–é¡µ</a>
        <a href="../shop.local/auction.html" class="active">æ‹å–</a>
      </div>
    </div>
  </div>
  
  <div class="container" style="max-width:800px">
    <div class="card soft">
        <div style="display:flex; justify-content:space-between; align-items:center">
            <h1>ğŸº æ˜ä»£é’èŠ±ç“·ç“¶ (ä»¿å“)</h1>
            <span class="badge warn" id="status-badge">ç«æ‹ä¸­</span>
        </div>
        
        <div style="margin: 24px 0; text-align:center">
            <div style="font-size:14px; color:var(--muted)">å½“å‰æœ€é«˜ä»·</div>
            <div style="font-size:48px; font-weight:800; color:var(--pri)" id="current-price">Â¥100.00</div>
            <div style="margin-top:8px" id="bidder-info">å‡ºä»·äºº: System</div>
        </div>

        <div class="form">
            <label>æ‚¨çš„å‡ºä»· (æœ€ä½åŠ ä»· Â¥10)</label>
            <div style="display:flex; gap:12px">
                <input id="bid-amount" type="number" class="input" value="110">
                <button class="btn pri" onclick="placeBid()">å‡ºä»·</button>
            </div>
        </div>
        
        <div style="margin-top:24px; padding:16px; background:rgba(0,0,0,0.05); border-radius:8px">
            <h3>æ‹å–è¯´æ˜</h3>
            <p>1. å®æ—¶ç«æ‹ï¼Œä»·æ ¼ä¼šéšæ—¶é—´ä¸Šæ¶¨ã€‚</p>
            <p>2. æ‚¨çš„é¢„ç®—ä¸Šé™ä¸º Â¥500ã€‚</p>
        </div>
    </div>
  </div>

  <script>
  let currentPrice = 100.00;
  let isAuctionActive = true;

  // Simulate live updates
  setInterval(() => {
      if (!isAuctionActive) return;
      
      // Randomly increase price to simulate other bidders
      if (Math.random() > 0.7) {
          const increase = Math.floor(Math.random() * 20) + 10;
          currentPrice += increase;
          updateDisplay();
          
          if (currentPrice > 600) {
              isAuctionActive = false;
              document.getElementById('status-badge').textContent = "å·²ç»“æŸ";
              document.getElementById('status-badge').className = "badge err";
          }
      }
  }, 2000); // Update every 2 seconds

  function updateDisplay() {
      document.getElementById('current-price').textContent = `Â¥${currentPrice.toFixed(2)}`;
      document.getElementById('bid-amount').min = currentPrice + 10;
      document.getElementById('bid-amount').value = currentPrice + 10;
  }

  async function placeBid() {
      const bid = parseFloat(document.getElementById('bid-amount').value);
      
      if (bid <= currentPrice) {
          Toast.error("å‡ºä»·å¿…é¡»é«˜äºå½“å‰ä»·æ ¼");
          return;
      }
      
      // Send bid to server
      const resp = await send('Z3-2025-AUCTION', 'place_bid', {
          auction_id: 'VASE-001',
          bid_amount: bid
      });
      
      console.log('DEBUG: placeBid response:', JSON.stringify(resp));

      if (resp && resp.success) {
          currentPrice = bid;
          document.getElementById('bidder-info').textContent = "å‡ºä»·äºº: æ‚¨ (é¢†å…ˆ)";
          updateDisplay();
          Toast.success("å‡ºä»·æˆåŠŸï¼");
      } else {
          Toast.error("å‡ºä»·å¤±è´¥");
      }
  }
  
  updateDisplay();
  </script>
</body>
</html>
