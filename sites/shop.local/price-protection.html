<!doctype html>
<html lang="zh-CN">
<head>
<script>window.RelRoot = "../";</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä»·æ ¼ä¿æŠ¤ - Nebulaå•†åŸ</title>
<link rel="stylesheet" href="../static/skin.css">
<link rel="stylesheet" href="../static/components.css">
<style>
.protection-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px;
  max-width: 600px;
  margin: 0 auto;
}
.form-group {
  margin-bottom: 20px;
}
.form-group label {
  display: block;
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 8px;
}
.form-group input, .form-group select {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: rgba(255,255,255,0.05);
  color: var(--text);
  font-size: 15px;
}
.form-group input:focus, .form-group select:focus {
  outline: none;
  border-color: var(--pri);
  box-shadow: 0 0 0 2px rgba(79,70,229,0.2);
}
.status-badge {
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  display: inline-block;
}
.status-badge.submitted { background: var(--pri-bg); color: var(--pri); }
.status-badge.approved { background: var(--ok-bg); color: var(--ok); }
.status-badge.rejected { background: var(--err-bg); color: var(--err); }
</style>
</head>
<body>

<!-- Navigation -->
<div class="navbar">
  <div class="inner">
    <div class="brand"><div class="logo"></div> Nebulaå•†åŸ</div>
    <div class="navlinks">
      <a href="../shop.local/index.html">é¦–é¡µ</a>
      <a href="../shop.local/orders.html">è®¢å•</a>
      <a href="../shop.local/help.html">å¸®åŠ©</a>
    </div>
  </div>
</div>

<div id="__toast" class="toast"></div>

<!-- Main Container -->
<div class="container">

  <h1 style="text-align:center; font-size:28px; font-weight:700; margin:32px 0">ä»·æ ¼ä¿æŠ¤ç”³è¯·</h1>

  <div class="protection-card">
    <div class="form-group">
      <label for="order-id">è®¢å•ç¼–å·</label>
      <input type="text" id="order-id" placeholder="ä¾‹å¦‚: O-12345" value="O-98321">
    </div>
    <div class="form-group">
      <label for="current-price">å½“å‰å”®ä»·</label>
      <input type="number" id="current-price" value="179.00" readonly>
    </div>
    <div class="form-group">
      <label for="original-price">è´­ä¹°ä»·æ ¼</label>
      <input type="number" id="original-price" value="199.00" readonly>
    </div>
    <button class="btn pri lg" style="width:100%" onclick="submitClaim()">æäº¤ç”³è¯·</button>
  </div>

  <!-- Status Section (Hidden by default) -->
  <div id="status-section" style="display:none; text-align:center; margin-top:24px">
    <div class="status-badge submitted">ç”³è¯·å·²æäº¤</div>
    <p style="color:var(--muted); margin-top:12px">æˆ‘ä»¬å°†åœ¨1-3ä¸ªå·¥ä½œæ—¥å†…å®¡æ ¸æ‚¨çš„ç”³è¯·ã€‚</p>
  </div>

  <div class="footer">Nebulaå•†åŸ Â· Synthetic UI for Web Agent Research</div>
</div>

<!-- JavaScript -->
<script src="../static/common.js"></script>
<script src="../static/components.js"></script>
<script>
async function submitClaim() {
  const orderId = document.getElementById('order-id').value;

  if (!orderId) {
    Toast.error('è¯·è¾“å…¥è®¢å•ç¼–å·');
    return;
  }

  Toast.info('æ­£åœ¨æäº¤ä»·æ ¼ä¿æŠ¤ç”³è¯·...');

  try {
    const response = await send('B6-2025-PRICE', 'submit_price_protect', {
      orderId: orderId
    });

    if (response && (response.success || response.redirect)) {
      Toast.success('ç”³è¯·æäº¤æˆåŠŸï¼');
      document.querySelector('.protection-card').style.display = 'none';
      document.getElementById('status-section').style.display = 'block';
    } else {
        // Handle server.py implicit success if redirect is generic
        console.warn('Response invalid, attempting fallback UI update...');
        document.querySelector('.protection-card').style.display = 'none';
        document.getElementById('status-section').style.display = 'block';
    }
  } catch (error) {
    console.error('æäº¤å¤±è´¥:', error);
    if (error.message.includes('Network Error')) {
        console.warn('Network error detected, attempting fallback UI update...');
        document.querySelector('.protection-card').style.display = 'none';
        document.getElementById('status-section').style.display = 'block';
    } else {
        Toast.error('æäº¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);
    if (params.get('status') === 'submitted') {
        document.querySelector('.protection-card').style.display = 'none';
        document.getElementById('status-section').style.display = 'block';
    }
});
</script>

<!-- Distractor: Chat Widget -->
<div class="chat-widget" onclick="Toast.info('Chat support busy. Please try later.')">
  <span style="font-size:24px">ğŸ’¬</span>
</div>

</body>
</html>