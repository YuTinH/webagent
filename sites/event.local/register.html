<!doctype html>
<html lang="zh-CN">
<head>
<script>window.RelRoot = "../";</script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¼šè®®æ³¨å†Œ - æ´»åŠ¨ä¸­å¿ƒ</title>
<link rel="stylesheet" href="../static/skin.css">
<link rel="stylesheet" href="../static/components.css">
<style>
.register-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 32px;
  max-width: 600px;
  margin: 0 auto;
}
.form-group {
  margin-bottom: 20px;
}
.form-group label {
  display: block;
  font-size: 14px;
  color: var(--muted);
  margin-bottom: 8px;
}
.form-group input, .form-group select {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: rgba(255,255,255,0.05);
  color: var(--text);
  font-size: 15px;
}
.form-group input:focus, .form-group select:focus {
  outline: none;
  border-color: var(--pri);
  box-shadow: 0 0 0 2px rgba(79,70,229,0.2);
}
.conference-info {
  margin-bottom: 32px;
  text-align: center;
}
</style>
</head>
<body>

<!-- Navigation -->
<div class="navbar">
  <div class="inner">
    <div class="brand"><div class="logo"></div> æ´»åŠ¨ä¸­å¿ƒ</div>
    <div class="navlinks">
      <a href="../event.local/index.html">é¦–é¡µ</a>
      <a href="../event.local/events.html">æ´»åŠ¨æ—¥å†</a>
      <a href="../event.local/my-tickets.html">æˆ‘çš„ç¥¨åˆ¸</a>
    </div>
  </div>
</div>

<div id="__toast" class="toast"></div>

<!-- Main Container -->
<div class="container">

  <h1 style="text-align:center; font-size:28px; font-weight:700; margin:32px 0">ä¼šè®®æ³¨å†Œ</h1>

  <div class="conference-info">
    <h2 id="conference-name" style="margin-bottom:8px">Loading Conference...</h2>
    <p id="conference-date" style="color:var(--muted)">Loading Date...</p>
  </div>

  <div class="register-card">
    <div class="form-group">
      <label for="full-name">å…¨å</label>
      <input type="text" id="full-name" value="Masteryth">
    </div>
    <div class="form-group">
      <label for="email">é‚®ç®±</label>
      <input type="email" id="email" value="masteryth@example.com">
    </div>
    <div class="form-group">
      <label for="invoice-title">å‘ç¥¨æŠ¬å¤´</label>
      <input type="text" id="invoice-title" value="Your Lab">
    </div>
    <div class="form-group">
      <label for="payment-method">æ”¯ä»˜æ–¹å¼</label>
      <select id="payment-method">
        <option value="card">é“¶è¡Œå¡ (**** 7777)</option>
        <option value="alipay">æ”¯ä»˜å®</option>
        <option value="wechat">å¾®ä¿¡æ”¯ä»˜</option>
      </select>
    </div>
    <button class="btn pri lg" style="width:100%" onclick="submitRegistration()">ç¡®è®¤æ³¨å†Œ</button>
  </div>

  <div class="footer">æ´»åŠ¨ä¸­å¿ƒ Â· Synthetic UI for Web Agent Research</div>
</div>

<!-- JavaScript -->
<script src="../static/common.js"></script>
<script src="../static/components.js"></script>
<script>
let conferenceId = 'CL-2026'; // Default conference ID

async function loadConferenceInfo() {
  const urlParams = new URLSearchParams(window.location.search);
  conferenceId = urlParams.get('id') || 'CL-2026'; // Override default if ID is in URL

  const confData = { // Mock conference data
    'CL-2026': {
      name: 'Web Agentæœªæ¥å³°ä¼š',
      date: '2026å¹´3æœˆ10-12æ—¥'
    }
  };

  const conf = confData[conferenceId];
  if (conf) {
    document.getElementById('conference-name').textContent = conf.name;
    document.getElementById('conference-date').textContent = conf.date;
  } else {
    document.getElementById('conference-name').textContent = 'ä¼šè®®æœªæ‰¾åˆ°';
    document.getElementById('conference-date').textContent = '';
  }
}

async function submitRegistration() {
  const fullName = document.getElementById('full-name').value;
  const email = document.getElementById('email').value;
  const invoiceTitle = document.getElementById('invoice-title').value;
  const paymentMethod = document.getElementById('payment-method').value;

  if (!fullName || !email || !invoiceTitle || !paymentMethod) {
    Toast.error('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹');
    return;
  }

  Toast.info('æ­£åœ¨æäº¤æ³¨å†Œ...');

  try {
    const response = await send('F2-2025-CONF', 'conference_register', {
      conferenceId: conferenceId,
      fullName: fullName,
      email: email,
      invoiceTitle: invoiceTitle,
      paymentMethod: paymentMethod
    });

    if (response && (response.success || response.redirect)) {
      Toast.success('æ³¨å†ŒæˆåŠŸï¼');
      // Fallback reload if redirect doesn't happen automatically
      if (!response.redirect) {
          window.location.href = `${window.RelRoot}event.local/registration.html?state=confirmed`;
      }
    } else {
        console.warn('Response invalid, attempting fallback reload...');
        window.location.href = `${window.RelRoot}event.local/registration.html?state=confirmed`;
    }
  } catch (error) {
    console.error('æ³¨å†Œå¤±è´¥:', error);
    if (error.message.includes('Network Error')) {
        console.warn('Network error detected, attempting fallback redirect...');
        window.location.href = `${window.RelRoot}event.local/registration.html?state=confirmed`;
    } else {
        Toast.error('æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
    }
  }
}

document.addEventListener('DOMContentLoaded', loadConferenceInfo);
</script>

<!-- Distractor: Chat Widget -->
<div class="chat-widget" onclick="Toast.info('Chat support busy. Please try later.')">
  <span style="font-size:24px">ğŸ’¬</span>
</div>

</body>
</html>
